create table if not exists aeropuerto (aeropuerto_id serial primary key, nombre varchar(120) not null, origen varchar(80) not null, destino varchar(80) not null);
create table if not exists usuario (usuario_id serial primary key, username varchar(60) unique not null, contrase√±a varchar(200) not null, perfil varchar(30) default 'pasajero');
create table if not exists pasajero (pasajero_id serial primary key, usuario_id int references usuario(usuario_id) on delete set null, nombre varchar(80) not null, apellido varchar(80) not null, documento varchar(40) unique not null, email varchar(120) not null);
create table if not exists vuelo (vuelo_id serial primary key, aeropuerto_id int references aeropuerto(aeropuerto_id) on delete set null, numero_vuelo varchar(12) not null, fecha date not null, estado varchar(20) default 'programado', hora_prog_salida time, hora_est_salida time, puerta varchar(8));
create table if not exists asiento (asiento_id serial primary key, vuelo_id int references vuelo(vuelo_id) on delete cascade, fila int not null, columna char(1) not null, unique(vuelo_id, fila, columna));
create table if not exists vuelo_pasajero (vuelo_pasajero_id serial primary key, reserva_id int, pasajero_id int references pasajero(pasajero_id) on delete cascade, vuelo_id int references vuelo(vuelo_id) on delete cascade, asiento_id int references asiento(asiento_id) on delete set null, unique(vuelo_id, pasajero_id));
create table if not exists checkin (checkin_id serial primary key, vuelo_pasajero_id int references vuelo_pasajero(vuelo_pasajero_id) on delete cascade, fecha timestamp default now());
create table if not exists cupon (cupon_id serial primary key, vuelo_id int references vuelo(vuelo_id) on delete cascade, pasajero_id int references pasajero(pasajero_id) on delete cascade, motivo varchar(80) default 'demora', valor numeric(10,2) default 0, moneda char(3) default 'ARS', emitido_at timestamp default now());
create index if not exists idx_vuelo_numero_fecha on vuelo (numero_vuelo, fecha);
create index if not exists idx_vp_pasajero on vuelo_pasajero (pasajero_id);
